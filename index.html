<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jastip Meili - Katalog Produk China üá®üá≥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2d3436;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
            text-align: center;
            padding: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .admin-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 2;
        }

        .admin-btn, .profile-btn, .category-manage-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .admin-btn:hover, .profile-btn:hover, .category-manage-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .admin-btn.active {
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .contact-section {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            padding: 25px;
            color: white;
            position: relative;
        }
        
        .contact-section h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .edit-profile-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .edit-profile-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .announcement-section {
            background: linear-gradient(135deg, #00b894, #00cec9);
            padding: 25px;
            color: white;
            position: relative;
        }
        
        .announcement-header {
            font-size: 1.5em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .announcement-content {
            font-size: 1.1em;
            line-height: 1.5;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .edit-announcement-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .edit-announcement-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .search-section {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .search-container {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
        }
        
        .search-input:focus {
            border-color: #74b9ff;
            box-shadow: 0 0 20px rgba(116, 185, 255, 0.2);
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #636e72;
            font-size: 20px;
        }
        
        .search-results-count {
            text-align: center;
            color: #636e72;
            margin-top: 10px;
            font-size: 14px;
        }

        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .contact-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .contact-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
        }

        .contact-item i {
            font-size: 2em;
            margin-bottom: 10px;
            display: block;
        }

        .categories {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            position: relative;
        }

        .categories-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .manage-categories-btn {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: none;
        }

        .manage-categories-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(253, 121, 168, 0.4);
        }

        .category-btn {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 5px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
            position: relative;
        }
        
        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(116, 185, 255, 0.4);
        }
        
        .category-btn.active {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
        }

        .products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
        }

        .product {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .product:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .product img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .product img:hover {
            transform: scale(1.05);
        }

        .product-info {
            padding: 20px;
        }

        .product-name {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 8px;
            color: #2d3436;
        }

        .product-price {
            font-size: 1.4em;
            font-weight: 800;
            color: #e17055;
            margin-bottom: 8px;
        }

        .product-desc {
            color: #636e72;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .whatsapp-btn {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 25px;
            display: inline-block;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            width: 100%;
        }

        .whatsapp-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
            text-decoration: none;
            color: white;
        }

        .add-product-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(108, 92, 231, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
            width: 60px;
            height: 60px;
            display: none;
        }

        .add-product-btn:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 8px 25px rgba(108, 92, 231, 0.6);
        }

        .admin-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .edit-btn, .delete-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .edit-btn {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
        }

        .delete-btn {
            background: linear-gradient(135deg, #e17055, #d63031);
            color: white;
        }

        .edit-btn:hover, .delete-btn:hover {
            transform: translateY(-2px);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        .modal-content-large {
            max-width: 800px;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover {
            color: #e17055;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3436;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #74b9ff;
            box-shadow: 0 0 10px rgba(116, 185, 255, 0.2);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
        }

        .btn-cancel {
            background: linear-gradient(135deg, #636e72, #2d3436);
        }

        .btn-cancel:hover {
            box-shadow: 0 5px 15px rgba(99, 110, 114, 0.4);
        }

        .category-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .category-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .category-item:last-child {
            margin-bottom: 0;
        }

        .category-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .category-name {
            font-weight: 600;
            color: #2d3436;
        }

        .category-value {
            font-size: 12px;
            color: #636e72;
            font-family: monospace;
            background: rgba(116, 185, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .category-product-count {
            font-size: 12px;
            color: #00b894;
            background: rgba(0, 184, 148, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .category-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 15px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
        }

        .btn-delete {
            background: linear-gradient(135deg, #e17055, #d63031);
            color: white;
        }

        .btn-small:hover {
            transform: translateY(-2px);
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 10px;
            display: none;
        }

        .compression-info {
            background: #e8f4fd;
            border: 1px solid #74b9ff;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-size: 12px;
            color: #0984e3;
            display: none;
        }

        .success-message, .error-message {
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            font-weight: 600;
            animation: slideInDown 0.3s ease;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #636e72;
            font-style: italic;
        }

        .image-modal {
            display: none;
            position: fixed;
            z-index: 3000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
        }

        .image-modal-content {
            position: relative;
            margin: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            max-width: 90%;
            max-height: 90%;
        }

        .image-modal img {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .image-modal-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 3001;
            background: rgba(0,0,0,0.5);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .image-modal-close:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }

        .image-modal-info {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            max-width: 500px;
        }

        .image-modal-title {
            font-size: 1.5em;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 10px;
        }

        .image-modal-price {
            font-size: 1.3em;
            font-weight: 800;
            color: #e17055;
            margin-bottom: 10px;
        }

        .image-modal-desc {
            color: #636e72;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .admin-controls { 
                top: 10px; 
                right: 10px; 
                flex-direction: column; 
                gap: 5px; 
            }
            .admin-btn, .profile-btn, .category-manage-btn { 
                padding: 8px 12px; 
                font-size: 14px; 
            }
            .products { 
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
                gap: 15px; 
                padding: 15px; 
            }
            .categories { 
                padding: 15px; 
            }
            .category-btn { 
                padding: 10px 20px; 
                font-size: 14px; 
            }
            .admin-buttons { 
                flex-direction: column; 
            }
            .category-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .category-actions {
                align-self: stretch;
                justify-content: center;
            }
            .categories-header {
                flex-direction: column;
                gap: 10px;
            }
            .modal-content-large {
                max-width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="admin-controls">
                <button class="profile-btn" id="profileBtn" onclick="openProfileModal()">‚öôÔ∏è</button>
                <button class="category-manage-btn" id="categoryManageBtn" onclick="openCategoryModal()">üè∑Ô∏è</button>
                <button class="admin-btn" id="adminModeBtn" onclick="toggleAdminMode()">üëÅÔ∏è</button>
            </div>
            <h1>üõçÔ∏è Jastip Meili</h1>
            <p>Katalog Produk China Berkualitas Dengan Harga Terjangkau! üá®üá≥‚ú®</p>
        </div>
        
        <div class="contact-section">
            <button class="edit-profile-btn" onclick="openProfileModal()" id="editProfileBtn" style="display: none;">‚úèÔ∏è Edit</button>
            <h2>üìû Hubungi Kami</h2>
            <div class="contact-grid" id="contactGrid">
                <div class="contact-item">
                    <i>üì±</i>
                    <h3>WhatsApp</h3>
                    <p id="contactWhatsapp">+62 821-6274-3088</p>
                </div>
                <div class="contact-item">
                    <i>üìß</i>
                    <h3>Email</h3>
                    <p id="contactEmail">meili.jastip@gmail.com</p>
                </div>
                <div class="contact-item">
                    <i>üì∏</i>
                    <h3>Instagram</h3>
                    <p id="contactInstagram">@meili_jastip_po</p>
                </div>
            </div>
        </div>
        
        <div class="announcement-section">
            <div class="announcement-header">
                <span>üì¢</span>
                <h2>Pengumuman</h2>
            </div>
            <div class="announcement-content" id="announcementContent">
                üéâ JASTIP OPEN! Siap kirim barang China berkualitas dengan harga terjangkau! 
                üì¶ Estimasi 7-14 hari sampai Indonesia. 
                üí∞ Pembayaran: Transfer bank atau e-wallet. 
                üöö Free ongkir untuk pembelian di atas Rp 500.000!
            </div>
            <button class="edit-announcement-btn" onclick="editAnnouncement()" id="editAnnouncementBtn" style="display: none;">‚úèÔ∏è Edit</button>
        </div>
        
        <div class="search-section">
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="üîç Cari produk... (nama, harga, deskripsi)">
                <span class="search-icon">üîç</span>
                <div class="search-results-count" id="searchResults"></div>
            </div>
        </div>
        
        <div class="categories">
            <div class="categories-header">
                <h3>üìÇ Kategori Produk</h3>
                <button class="manage-categories-btn" id="manageCategoriesBtn" onclick="openCategoryModal()">üè∑Ô∏è Kelola Kategori</button>
            </div>
            <button class="category-btn active" onclick="filterProducts('all')">Semua Produk</button>
            <div id="dynamicCategories">
                <!-- Categories will be loaded here dynamically -->
            </div>
        </div>

        <div class="products" id="products-container">
            <div class="loading">Memuat produk...</div>
        </div>

        <button class="add-product-btn" id="addProductBtn" onclick="openModal()">‚ûï</button>
    </div>

    <!-- Modals -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProfileModal()">&times;</span>
            <h2>‚öôÔ∏è Pengaturan Profil</h2>
            <form id="profileForm">
                <div class="form-group">
                    <label for="profileWhatsapp">Nomor WhatsApp:</label>
                    <input type="text" id="profileWhatsapp" placeholder="+62 821-6274-3088" required>
                </div>
                <div class="form-group">
                    <label for="profileEmail">Email:</label>
                    <input type="email" id="profileEmail" placeholder="meili.jastip@gmail.com" required>
                </div>
                <div class="form-group">
                    <label for="profileInstagram">Username Instagram:</label>
                    <input type="text" id="profileInstagram" placeholder="@meili_jastip_po" required>
                </div>
                <div class="form-group">
                    <label for="profileBusinessName">Nama Bisnis:</label>
                    <input type="text" id="profileBusinessName" placeholder="Jastip Meili" required>
                </div>
                <div class="form-group">
                    <label for="profileDescription">Deskripsi Bisnis:</label>
                    <textarea id="profileDescription" placeholder="Katalog Produk China Berkualitas Dengan Harga Terjangkau! üá®üá≥‚ú®" required></textarea>
                </div>
                <div style="margin-top: 30px;">
                    <button type="submit" class="btn">üíæ Simpan Profil</button>
                    <button type="button" class="btn btn-cancel" onclick="closeProfileModal()">Batal</button>
                </div>
            </form>
        </div>
    </div>

    <div id="categoryModal" class="modal">
        <div class="modal-content modal-content-large">
            <span class="close" onclick="closeCategoryModal()">&times;</span>
            <h2>üè∑Ô∏è Kelola Kategori</h2>
            
            <div class="form-group">
                <h3>‚ûï Tambah Kategori Baru</h3>
                <form id="addCategoryForm" style="display: flex; gap: 10px; align-items: end;">
                    <div style="flex: 1;">
                        <label for="newCategoryName">Nama Kategori:</label>
                        <input type="text" id="newCategoryName" placeholder="Contoh: Elektronik" required>
                    </div>
                    <div style="flex: 1;">
                        <label for="newCategoryValue">Value (untuk kode):</label>
                        <input type="text" id="newCategoryValue" placeholder="elektronik" required>
                        <small style="color: #636e72; font-size: 12px;">Huruf kecil, tanpa spasi. Gunakan dash (-) untuk kata majemuk</small>
                    </div>
                    <button type="submit" class="btn" style="margin: 0;">‚ûï Tambah</button>
                </form>
            </div>

            <div class="form-group">
                <h3>üìã Daftar Kategori</h3>
                <div class="category-list" id="categoryList">
                    <!-- Categories will be loaded here -->
                </div>
            </div>

            <div style="margin-top: 30px; text-align: center;">
                <button type="button" class="btn btn-cancel" onclick="closeCategoryModal()">Tutup</button>
            </div>
        </div>
    </div>

    <div id="editCategoryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditCategoryModal()">&times;</span>
            <h2>‚úèÔ∏è Edit Kategori</h2>
            <form id="editCategoryForm">
                <input type="hidden" id="editCategoryId">
                <div class="form-group">
                    <label for="editCategoryName">Nama Kategori:</label>
                    <input type="text" id="editCategoryName" required>
                </div>
                <div class="form-group">
                    <label for="editCategoryValue">Value (untuk kode):</label>
                    <input type="text" id="editCategoryValue" required>
                    <small style="color: #636e72; font-size: 12px;">Huruf kecil, tanpa spasi. Gunakan dash (-) untuk kata majemuk</small>
                </div>
                <div style="margin-top: 30px;">
                    <button type="submit" class="btn">üíæ Simpan Perubahan</button>
                    <button type="button" class="btn btn-cancel" onclick="closeEditCategoryModal()">Batal</button>
                </div>
            </form>
        </div>
    </div>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Tambah Produk Baru</h2>
            <form id="productForm">
                <div class="form-group">
                    <label for="productName">Nama Produk:</label>
                    <input type="text" id="productName" placeholder="Contoh: Xiaomi 13 Pro" required>
                </div>
                <div class="form-group">
                    <label for="productPrice">Harga:</label>
                    <input type="text" id="productPrice" placeholder="Contoh: Rp 5.500.000" required>
                </div>
                <div class="form-group">
                    <label for="productCategory">Kategori:</label>
                    <select id="productCategory" required>
                        <option value="">Pilih kategori</option>
                        <!-- Categories will be loaded here dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="productImage">Gambar Produk (URL):</label>
                    <input type="url" id="productImage" placeholder="https://example.com/gambar.jpg">
                </div>
                <div class="form-group">
                    <label for="productImageFile">Atau Upload Gambar:</label>
                    <input type="file" id="productImageFile" accept="image/*">
                    <img id="imagePreview" class="image-preview" alt="Preview">
                    <div id="compressionInfo" class="compression-info"></div>
                </div>
                <div class="form-group">
                    <label for="productDesc">Deskripsi:</label>
                    <textarea id="productDesc" placeholder="Deskripsi detail produk..." required></textarea>
                </div>
                <button type="submit" class="btn" id="submitBtn">üíæ Simpan Produk</button>
                <button type="button" class="btn btn-cancel" onclick="closeModal()">Batal</button>
            </form>
        </div>
    </div>

    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="closeImageModal()">&times;</span>
        <div class="image-modal-content">
            <img id="modalImage" src="" alt="">
            <div class="image-modal-info">
                <div class="image-modal-title" id="modalImageTitle"></div>
                <div class="image-modal-price" id="modalImagePrice"></div>
                <div class="image-modal-desc" id="modalImageDesc"></div>
            </div>
        </div>
    </div>

    <div id="announcementModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAnnouncementModal()">&times;</span>
            <h2>Edit Pengumuman</h2>
            <form id="announcementForm">
                <div class="form-group">
                    <label for="announcementText">Pengumuman:</label>
                    <textarea id="announcementText" rows="6" placeholder="Tulis pengumuman disini..." required></textarea>
                </div>
                <button type="submit" class="btn">üíæ Simpan Pengumuman</button>
                <button type="button" class="btn btn-cancel" onclick="closeAnnouncementModal()">Batal</button>
            </form>
        </div>
    </div>

    <script type="module">
        // Silent error handling untuk user
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;
        
        console.error = function(...args) {
            // Only log Firebase-related errors to developer console, nothing else
            if (args.some(arg => String(arg).includes('Firebase') || String(arg).includes('firestore'))) {
                originalConsoleError.apply(console, ['üî• Firebase status:', ...args]);
            }
        };
        
        console.warn = function(...args) {
            // Only log important warnings
            if (args.some(arg => String(arg).includes('Firebase') || String(arg).includes('firestore'))) {
                originalConsoleWarn.apply(console, ['‚ö†Ô∏è Firebase warning:', ...args]);
            }
        };

        window.addEventListener('error', function(e) {
            // Don't show any errors to user, just log for dev
            e.preventDefault();
            return true;
        });

        window.addEventListener('unhandledrejection', function(e) {
            // Handle Firebase connection issues silently
            e.preventDefault();
            return true;
        });

        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, orderBy, query, deleteDoc, doc, updateDoc, onSnapshot, where } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAAqI3ZOUGMWF-G9seswlwW9fcBYymZYmk",
            authDomain: "jastip-meili-cdabe.firebaseapp.com",
            projectId: "jastip-meili-cdabe",
            storageBucket: "jastip-meili-cdabe.firebasestorage.app",
            messagingSenderId: "141192963852",
            appId: "1:141192963852:web:6a89b75151645915d8cb29",
            measurementId: "G-2GLST099VL"
        };

        // Global variables
        let app, db;
        let isFirebaseConnected = false;
        let products = [];
        let categories = [];
        let currentFilter = 'all';
        let adminMode = false;
        let editingProductId = null;
        let unsubscribe = null;
        let categoriesUnsubscribe = null;
        let searchQuery = '';
        let profileData = {
            whatsapp: '+62 821-6274-3088',
            email: 'meili.jastip@gmail.com',
            instagram: '@meili_jastip_po',
            businessName: 'Jastip Meili',
            description: 'Katalog Produk China Berkualitas Dengan Harga Terjangkau! üá®üá≥‚ú®'
        };

        // Default categories
        const defaultCategories = [
            { id: 'elektronik', name: 'Elektronik', value: 'elektronik' },
            { id: 'baju', name: 'Baju', value: 'baju' },
            { id: 'celana', name: 'Celana', value: 'celana' },
            { id: 'sepatu', name: 'Sepatu', value: 'sepatu' },
            { id: 'kecantikan', name: 'Kecantikan', value: 'kecantikan' },
            { id: 'rumah-tangga', name: 'Rumah Tangga', value: 'rumah-tangga' },
            { id: 'makanan', name: 'Makanan', value: 'makanan' }
        ];

        // Default products for fallback
        const defaultProducts = [
            {
                id: '1',
                name: 'Xiaomi 13 Pro',
                price: 'Rp 5.500.000',
                category: 'elektronik',
                image: 'https://images.unsplash.com/photo-1592899677977-9c10ca588bbd?w=300&h=200&fit=crop',
                desc: 'Smartphone flagship dengan kamera Leica, Snapdragon 8 Gen 2, dan layar OLED 120Hz'
            },
            {
                id: '2',
                name: 'Tas Ransel Korea',
                price: 'Rp 850.000',
                category: 'tas',
                image: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=300&h=200&fit=crop',
                desc: 'Tas ransel premium dengan bahan kanvas tebal, anti air, dan design minimalis'
            },
            {
                id: '3',
                name: 'Jaket Bomber Unisex',
                price: 'Rp 650.000',
                category: 'baju',
                image: 'https://images.unsplash.com/photo-1544022613-e87ca75a784a?w=300&h=200&fit=crop',
                desc: 'Jaket bomber premium dengan material polyester, hangat dan stylish untuk sehari-hari'
            },
            {
                id: '4',
                name: 'Sepatu Sneakers Putih',
                price: 'Rp 750.000',
                category: 'sepatu',
                image: 'https://images.unsplash.com/photo-1549298916-b41d501d3772?w=300&h=200&fit=crop',
                desc: 'Sneakers casual dengan sol empuk, breathable material, cocok untuk aktivitas sehari-hari'
            },
            {
                id: '5',
                name: 'Serum Vitamin C',
                price: 'Rp 450.000',
                category: 'kecantikan',
                image: 'https://images.unsplash.com/photo-1556228720-195a672e8a03?w=300&h=200&fit=crop',
                desc: 'Serum brightening dengan 20% Vitamin C, mencerahkan dan melembabkan kulit wajah'
            },
            {
                id: '6',
                name: 'Coffee Grinder Manual',
                price: 'Rp 380.000',
                category: 'rumah-tangga',
                image: 'https://images.unsplash.com/photo-1610889556528-9a770e32642f?w=300&h=200&fit=crop',
                desc: 'Penggiling kopi manual dengan ceramic burr, hasil grinding konsisten untuk kopi terbaik'
            }
        ];

        // Check password
        function checkPassword(action = 'admin') {
            try {
                const password = prompt(action === 'profile' ? 
                    'üîê Masukkan password untuk edit profil:' : 
                    'üîê Masukkan password admin:'
                );
                
                if (password === 'meili2024') {
                    return true;
                } else if (password !== null) {
                    alert('‚ùå Password salah! Akses ditolak.');
                    return false;
                }
                return false;
            } catch (e) {
                return false;
            }
        }

        // Initialize Firebase with enhanced error handling
        function initFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                isFirebaseConnected = true;
                console.log('‚úÖ Firebase berhasil terhubung - data produk akan tersimpan permanen');
            } catch (error) {
                console.log('‚ö†Ô∏è Firebase offline - menggunakan data lokal sementara');
                isFirebaseConnected = false;
                // Jangan tampilkan error yang menakutkan ke user
            }
        }

        // Show messages
        function showSuccess(message) {
            try {
                const container = document.getElementById('products-container');
                if (!container) return;
                
                const existingSuccess = container.querySelector('.success-message');
                if (existingSuccess) existingSuccess.remove();
                
                const successDiv = document.createElement('div');
                successDiv.className = 'success-message';
                successDiv.textContent = message;
                successDiv.style.gridColumn = '1 / -1';
                container.insertBefore(successDiv, container.firstChild);
                
                setTimeout(() => {
                    try {
                        if (successDiv && successDiv.parentNode) {
                            successDiv.remove();
                        }
                    } catch (e) {}
                }, 5000);
            } catch (e) {}
        }

        function showError(message) {
            try {
                const container = document.getElementById('products-container');
                if (!container) return;
                
                const existingError = container.querySelector('.error-message');
                if (existingError) existingError.remove();
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.textContent = message;
                errorDiv.style.gridColumn = '1 / -1';
                container.insertBefore(errorDiv, container.firstChild);
                
                setTimeout(() => {
                    try {
                        if (errorDiv && errorDiv.parentNode) {
                            errorDiv.remove();
                        }
                    } catch (e) {}
                }, 8000);
            } catch (e) {}
        }

        // Category Functions
        async function saveCategory(categoryData) {
            if (!isFirebaseConnected || !db) {
                const localCategories = JSON.parse(localStorage.getItem('jastip_categories') || '[]');
                localCategories.push({
                    id: Date.now().toString(),
                    ...categoryData,
                    createdAt: new Date()
                });
                localStorage.setItem('jastip_categories', JSON.stringify(localCategories));
                return Date.now().toString();
            }
            
            try {
                const docRef = await addDoc(collection(db, "categories"), {
                    ...categoryData,
                    createdAt: new Date()
                });
                return docRef.id;
            } catch (error) {
                throw error;
            }
        }

        async function updateCategory(categoryId, categoryData) {
            if (!isFirebaseConnected || !db) {
                const localCategories = JSON.parse(localStorage.getItem('jastip_categories') || '[]');
                const index = localCategories.findIndex(c => c.id === categoryId);
                if (index > -1) {
                    localCategories[index] = { ...localCategories[index], ...categoryData, updatedAt: new Date() };
                    localStorage.setItem('jastip_categories', JSON.stringify(localCategories));
                }
                return;
            }
            
            try {
                const categoryRef = doc(db, "categories", categoryId);
                await updateDoc(categoryRef, {
                    ...categoryData,
                    updatedAt: new Date()
                });
            } catch (error) {
                throw error;
            }
        }

        async function deleteCategory(categoryId) {
            if (!isFirebaseConnected || !db) {
                const localCategories = JSON.parse(localStorage.getItem('jastip_categories') || '[]');
                const filtered = localCategories.filter(c => c.id !== categoryId);
                localStorage.setItem('jastip_categories', JSON.stringify(filtered));
                return;
            }
            
            try {
                await deleteDoc(doc(db, "categories", categoryId));
            } catch (error) {
                throw error;
            }
        }

        function loadCategories() {
            if (!isFirebaseConnected || !db) {
                console.log('üì± Mode offline - menggunakan kategori default');
                const localCategories = JSON.parse(localStorage.getItem('jastip_categories') || '[]');
                categories = localCategories.length > 0 ? localCategories : [...defaultCategories];
                displayCategories();
                updateCategoryDropdown();
                return;
            }
            
            try {
                console.log('üîÑ Memuat kategori dari database...');
                const q = query(collection(db, "categories"), orderBy("createdAt", "desc"));
                
                if (categoriesUnsubscribe) {
                    categoriesUnsubscribe();
                }
                
                categoriesUnsubscribe = onSnapshot(q, (querySnapshot) => {
                    categories = [];
                    querySnapshot.forEach((doc) => {
                        categories.push({ id: doc.id, ...doc.data() });
                    });
                    
                    if (categories.length === 0) {
                        categories = [...defaultCategories];
                        // Save default categories to Firebase
                        defaultCategories.forEach(async (cat) => {
                            try {
                                await saveCategory({ name: cat.name, value: cat.value });
                            } catch (e) {}
                        });
                    }
                    
                    console.log(`üîÑ Kategori berhasil dimuat: ${categories.length} item`);
                    displayCategories();
                    updateCategoryDropdown();
                    displayCategoryList();
                }, (error) => {
                    console.log('‚ö†Ô∏è Koneksi database terputus, menggunakan kategori default');
                    categories = [...defaultCategories];
                    displayCategories();
                    updateCategoryDropdown();
                });
                
            } catch (error) {
                console.log('üì± Fallback ke kategori default');
                categories = [...defaultCategories];
                displayCategories();
                updateCategoryDropdown();
            }
        }

        function displayCategories() {
            try {
                const container = document.getElementById('dynamicCategories');
                if (!container) return;
                
                const categoriesHTML = categories.map(category => 
                    `<button class="category-btn" onclick="filterProducts('${category.value}')">${category.name}</button>`
                ).join('');
                
                container.innerHTML = categoriesHTML;
            } catch (e) {}
        }

        function updateCategoryDropdown() {
            try {
                const dropdown = document.getElementById('productCategory');
                if (!dropdown) return;
                
                // Keep the first option
                const firstOption = dropdown.querySelector('option[value=""]');
                dropdown.innerHTML = '';
                if (firstOption) dropdown.appendChild(firstOption);
                
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.value;
                    option.textContent = category.name;
                    dropdown.appendChild(option);
                });
            } catch (e) {}
        }

        function displayCategoryList() {
            try {
                const container = document.getElementById('categoryList');
                if (!container) return;
                
                const categoriesHTML = categories.map(category => {
                    const productCount = products.filter(p => p.category === category.value).length;
                    return `
                        <div class="category-item">
                            <div class="category-info">
                                <div class="category-name">${category.name}</div>
                                <div class="category-value">${category.value}</div>
                                <div class="category-product-count">${productCount} produk</div>
                            </div>
                            <div class="category-actions">
                                <button class="btn-small btn-edit" onclick="editCategoryHandler('${category.id}', '${category.name.replace(/'/g, "\\'")}', '${category.value}')">‚úèÔ∏è Edit</button>
                                <button class="btn-small btn-delete" onclick="deleteCategoryHandler('${category.id}', '${category.name.replace(/'/g, "\\'")}', ${productCount})">üóëÔ∏è Hapus</button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = categoriesHTML || '<p style="text-align: center; color: #636e72; padding: 20px;">Belum ada kategori</p>';
            } catch (e) {}
        }

        window.editCategoryHandler = function(categoryId, categoryName, categoryValue) {
            try {
                document.getElementById('editCategoryId').value = categoryId;
                document.getElementById('editCategoryName').value = categoryName;
                document.getElementById('editCategoryValue').value = categoryValue;
                document.getElementById('editCategoryModal').style.display = 'block';
            } catch (e) {}
        }

        window.deleteCategoryHandler = async function(categoryId, categoryName, productCount) {
            try {
                let confirmMessage = `üóëÔ∏è Hapus kategori "${categoryName}"?`;
                if (productCount > 0) {
                    confirmMessage += `\n\n‚ö†Ô∏è PERHATIAN: Ada ${productCount} produk dalam kategori ini.\nProduk akan tetap ada tetapi kehilangan kategorinya.`;
                }
                confirmMessage += '\n\nTindakan ini tidak dapat dibatalkan!';
                
                const confirmDelete = confirm(confirmMessage);
                if (!confirmDelete) return;
                
                await deleteCategory(categoryId);
                showSuccess(`‚úÖ Kategori "${categoryName}" berhasil dihapus!`);
                
                // Update categories array immediately for UI
                categories = categories.filter(c => c.id !== categoryId);
                displayCategories();
                displayCategoryList();
                updateCategoryDropdown();
                
            } catch (e) {
                showError('‚ùå Gagal menghapus kategori. Silakan coba lagi.');
            }
        }

        // Utility function to generate value from name
        function generateCategoryValue(name) {
            return name.toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '') // Remove special characters
                .replace(/\s+/g, '-') // Replace spaces with dashes
                .replace(/-+/g, '-') // Replace multiple dashes with single dash
                .replace(/^-|-$/g, ''); // Remove leading/trailing dashes
        }

        // Firebase Functions
        async function saveProduct(productData) {
            if (!isFirebaseConnected || !db) {
                throw new Error('Koneksi database tidak tersedia');
            }
            
            try {
                const docRef = await addDoc(collection(db, "products"), {
                    ...productData,
                    createdAt: new Date()
                });
                return docRef.id;
            } catch (error) {
                throw error;
            }
        }

        async function updateProduct(productId, productData) {
            if (!isFirebaseConnected || !db) {
                throw new Error('Koneksi database tidak tersedia');
            }
            
            try {
                const productRef = doc(db, "products", productId);
                await updateDoc(productRef, {
                    ...productData,
                    updatedAt: new Date()
                });
            } catch (error) {
                throw error;
            }
        }

        async function deleteProduct(productId) {
            if (!isFirebaseConnected || !db) {
                throw new Error('Koneksi database tidak tersedia');
            }
            
            try {
                await deleteDoc(doc(db, "products", productId));
            } catch (error) {
                throw error;
            }
        }

        // Load products with real-time updates
        function loadProducts() {
            if (!isFirebaseConnected || !db) {
                console.log('üì± Mode offline - menggunakan produk contoh');
                products = [...defaultProducts];
                displayProducts();
                displayCategoryList();
                loadProfile();
                return;
            }
            
            try {
                console.log('üîÑ Memuat produk dari database...');
                const q = query(collection(db, "products"), orderBy("createdAt", "desc"));
                
                if (unsubscribe) {
                    unsubscribe();
                }
                
                unsubscribe = onSnapshot(q, (querySnapshot) => {
                    products = [];
                    querySnapshot.forEach((doc) => {
                        products.push({ id: doc.id, ...doc.data() });
                    });
                    
                    console.log(`üîÑ Produk berhasil dimuat: ${products.length} item`);
                    displayProducts();
                    displayCategoryList();
                }, (error) => {
                    console.log('‚ö†Ô∏è Koneksi database terputus, menggunakan data cache');
                    if (products.length === 0) {
                        products = [...defaultProducts];
                        displayProducts();
                        displayCategoryList();
                    }
                });
                
                loadProfile();
                
            } catch (error) {
                console.log('üì± Fallback ke mode offline');
                products = [...defaultProducts];
                displayProducts();
                displayCategoryList();
                loadProfile();
            }
        }

        // Display products
        function displayProducts() {
            try {
                const container = document.getElementById('products-container');
                if (!container) return;
                
                const existingContent = Array.from(container.children);
                const messagesToKeep = existingContent.filter(el => 
                    el.classList.contains('error-message') || el.classList.contains('success-message')
                );
                
                let filteredProducts = currentFilter === 'all' ? products : products.filter(p => p.category === currentFilter);
                
                if (searchQuery.trim()) {
                    filteredProducts = filteredProducts.filter(product => {
                        try {
                            const searchLower = searchQuery.toLowerCase();
                            return (
                                product.name.toLowerCase().includes(searchLower) ||
                                product.desc.toLowerCase().includes(searchLower) ||
                                product.price.toLowerCase().includes(searchLower) ||
                                product.category.toLowerCase().includes(searchLower)
                            );
                        } catch (e) {
                            return false;
                        }
                    });
                }
                
                updateSearchResults(filteredProducts.length);
                
                if (filteredProducts.length === 0) {
                    container.innerHTML = '';
                    messagesToKeep.forEach(msg => {
                        try {
                            container.appendChild(msg);
                        } catch (e) {}
                    });
                    
                    const emptyMessage = document.createElement('p');
                    emptyMessage.style.cssText = 'text-align: center; grid-column: 1/-1; color: #636e72; font-size: 1.2em; padding: 40px;';
                    
                    if (searchQuery.trim()) {
                        emptyMessage.innerHTML = `üîç Tidak ditemukan produk dengan kata kunci "<strong>${searchQuery}</strong>"<br><small>Coba kata kunci lain atau hapus pencarian</small>`;
                    } else if (currentFilter === 'all') {
                        emptyMessage.textContent = 'Memuat produk...';
                    } else {
                        emptyMessage.textContent = 'Tidak ada produk dalam kategori ini';
                    }
                    
                    container.appendChild(emptyMessage);
                    return;
                }
                
                const productsHTML = filteredProducts.map(product => {
                    try {
                        const whatsappNumber = profileData.whatsapp.replace(/[^\d]/g, '');
                        
                        const whatsappMessage = `Halo kak! Saya tertarik dengan produk:

üì± *${product.name}*
üí∞ ${product.price}
üìù ${product.desc}

Apakah produk ini masih tersedia? Terima kasih!`;
                        
                        const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(whatsappMessage)}`;
                        
                        const adminButtons = adminMode && product.id ? 
                            `<div class="admin-buttons">
                                <button class="edit-btn" onclick="editProduct('${product.id}')">‚úèÔ∏è Edit</button>
                                <button class="delete-btn" onclick="handleDeleteProduct('${product.id}', '${product.name.replace(/'/g, "\\'")}')">üóëÔ∏è Hapus</button>
                             </div>` : '';
                        
                        return `
                            <div class="product ${product.category}">
                                <img src="${product.image}" alt="${product.name}" 
                                     onclick="openImageModal('${product.image.replace(/'/g, "\\'")}', '${product.name.replace(/'/g, "\\'")}', '${product.price.replace(/'/g, "\\'")}', '${product.desc.replace(/'/g, "\\'")}', event)"
                                     onerror="this.src='https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=300&h=200&fit=crop'"
                                     title="Klik untuk melihat gambar lebih besar">
                                <div class="product-info">
                                    <div class="product-name">${product.name}</div>
                                    <div class="product-price">${product.price}</div>
                                    <div class="product-desc">${product.desc}</div>
                                    <a href="${whatsappURL}" target="_blank" class="whatsapp-btn">
                                        üí¨ Pesan via WhatsApp
                                    </a>
                                    ${adminButtons}
                                </div>
                            </div>
                        `;
                    } catch (e) {
                        return '';
                    }
                }).join('');
                
                container.innerHTML = '';
                messagesToKeep.forEach(msg => {
                    try {
                        container.appendChild(msg);
                    } catch (e) {}
                });
                container.insertAdjacentHTML('beforeend', productsHTML);
            } catch (e) {}
        }
        
        function updateSearchResults(count) {
            try {
                const resultsEl = document.getElementById('searchResults');
                if (!resultsEl) return;
                
                if (searchQuery.trim()) {
                    resultsEl.textContent = `${count} produk ditemukan untuk "${searchQuery}"`;
                    resultsEl.style.display = 'block';
                } else {
                    resultsEl.style.display = 'none';
                }
            } catch (e) {}
        }

        // Profile Functions
        async function saveProfile(data) {
            const profileToSave = {
                ...data,
                whatsapp: formatWhatsappNumber(data.whatsapp),
                instagram: formatInstagram(data.instagram)
            };

            if (!isFirebaseConnected || !db) {
                localStorage.setItem('jastip_profile', JSON.stringify(profileToSave));
                return;
            }
            
            try {
                const docData = { 
                    type: 'profile',
                    ...profileToSave, 
                    updatedAt: new Date() 
                };
                
                const q = query(collection(db, "settings"), where("type", "==", "profile"));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    const doc = querySnapshot.docs[0];
                    await updateDoc(doc.ref, docData);
                } else {
                    await addDoc(collection(db, "settings"), docData);
                }
                
            } catch (error) {
                localStorage.setItem('jastip_profile', JSON.stringify(profileToSave));
                throw error;
            }
        }
        
        async function loadProfile() {
            if (!isFirebaseConnected || !db) {
                const saved = localStorage.getItem('jastip_profile');
                if (saved) {
                    try {
                        profileData = { ...profileData, ...JSON.parse(saved) };
                        updateProfileDisplay();
                    } catch (e) {
                        // Silent error
                    }
                }
                return;
            }
            
            try {
                const q = query(collection(db, "settings"), where("type", "==", "profile"));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    const doc = querySnapshot.docs[0];
                    const data = doc.data();
                    profileData = { ...profileData, ...data };
                    updateProfileDisplay();
                }
                
            } catch (error) {
                const saved = localStorage.getItem('jastip_profile');
                if (saved) {
                    try {
                        profileData = { ...profileData, ...JSON.parse(saved) };
                        updateProfileDisplay();
                    } catch (e) {
                        // Silent error
                    }
                }
            }
        }

        function formatWhatsappNumber(number) {
            let formatted = number.replace(/[^\d+]/g, '');
            
            if (formatted.startsWith('0')) {
                formatted = '+62' + formatted.substring(1);
            } else if (formatted.startsWith('62')) {
                formatted = '+' + formatted;
            } else if (!formatted.startsWith('+62')) {
                formatted = '+62' + formatted;
            }
            
            return formatted;
        }

        function formatInstagram(username) {
            return '@' + username.replace('@', '');
        }

        function updateProfileDisplay() {
            try {
                const headerTitle = document.querySelector('.header h1');
                const headerDesc = document.querySelector('.header p');
                
                if (headerTitle) headerTitle.textContent = `üõçÔ∏è ${profileData.businessName}`;
                if (headerDesc) headerDesc.textContent = profileData.description;

                document.getElementById('contactWhatsapp').textContent = profileData.whatsapp;
                document.getElementById('contactEmail').textContent = profileData.email;
                document.getElementById('contactInstagram').textContent = profileData.instagram;
            } catch (e) {}
        }

        // Admin Functions
        window.toggleAdminMode = function() {
            try {
                if (!checkPassword('admin')) {
                    return;
                }
                
                adminMode = !adminMode;
                const btn = document.getElementById('adminModeBtn');
                const editAnnouncementBtn = document.getElementById('editAnnouncementBtn');
                const editProfileBtn = document.getElementById('editProfileBtn');
                const manageCategoriesBtn = document.getElementById('manageCategoriesBtn');
                const categoryManageBtn = document.getElementById('categoryManageBtn');
                
                if (adminMode) {
                    if (btn) {
                        btn.classList.add('active');
                        btn.textContent = 'üë§';
                    }
                    if (editAnnouncementBtn) editAnnouncementBtn.style.display = 'block';
                    if (editProfileBtn) editProfileBtn.style.display = 'block';
                    if (manageCategoriesBtn) manageCategoriesBtn.style.display = 'inline-block';
                    if (categoryManageBtn) categoryManageBtn.style.display = 'inline-block';
                    
                    // Show add product button
                    const addBtn = document.getElementById('addProductBtn');
                    if (addBtn) addBtn.style.display = 'block';
                    
                    showSuccess('‚úÖ Mode Admin AKTIF - Semua fitur admin tersedia!');
                } else {
                    if (btn) {
                        btn.classList.remove('active');
                        btn.textContent = 'üëÅÔ∏è';
                    }
                    if (editAnnouncementBtn) editAnnouncementBtn.style.display = 'none';
                    if (editProfileBtn) editProfileBtn.style.display = 'none';
                    if (manageCategoriesBtn) manageCategoriesBtn.style.display = 'none';
                    if (categoryManageBtn) categoryManageBtn.style.display = 'none';
                    
                    // Hide add product button
                    const addBtn = document.getElementById('addProductBtn');
                    if (addBtn) addBtn.style.display = 'none';
                    
                    showSuccess('‚ÑπÔ∏è Mode Admin NONAKTIF');
                }
                
                displayProducts();
            } catch (e) {}
        }

        // Modal Functions
        window.openCategoryModal = function() {
            try {
                if (!adminMode) {
                    if (!checkPassword('admin')) {
                        return;
                    }
                    // Temporarily enable admin mode for this action
                    adminMode = true;
                }
                
                displayCategoryList();
                document.getElementById('categoryModal').style.display = 'block';
            } catch (e) {}
        }

        window.closeCategoryModal = function() {
            try {
                document.getElementById('categoryModal').style.display = 'none';
                document.getElementById('addCategoryForm').reset();
            } catch (e) {}
        }

        window.closeEditCategoryModal = function() {
            try {
                document.getElementById('editCategoryModal').style.display = 'none';
                document.getElementById('editCategoryForm').reset();
            } catch (e) {}
        }

        window.openModal = function() {
            try {
                if (!adminMode) {
                    alert('üîí Mode admin diperlukan untuk menambah produk!\n\nKlik tombol üëÅÔ∏è di kanan atas dan masukkan password.');
                    return;
                }
                
                const modalTitle = document.getElementById('modalTitle');
                const submitBtn = document.getElementById('submitBtn');
                const productForm = document.getElementById('productForm');
                const imagePreview = document.getElementById('imagePreview');
                const compressionInfo = document.getElementById('compressionInfo');
                const productModal = document.getElementById('productModal');
                
                if (modalTitle) modalTitle.textContent = 'Tambah Produk Baru';
                if (submitBtn) submitBtn.textContent = 'üíæ Simpan Produk';
                if (productForm) productForm.reset();
                if (imagePreview) imagePreview.style.display = 'none';
                if (compressionInfo) compressionInfo.style.display = 'none';
                editingProductId = null;
                if (productModal) productModal.style.display = 'block';
            } catch (e) {}
        }

        window.closeModal = function() {
            try {
                const productModal = document.getElementById('productModal');
                const productForm = document.getElementById('productForm');
                const imagePreview = document.getElementById('imagePreview');
                const compressionInfo = document.getElementById('compressionInfo');
                
                if (productModal) productModal.style.display = 'none';
                if (productForm) productForm.reset();
                if (imagePreview) imagePreview.style.display = 'none';
                if (compressionInfo) compressionInfo.style.display = 'none';
                editingProductId = null;
            } catch (e) {}
        }

        window.editProduct = function(productId) {
            try {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                const modalTitle = document.getElementById('modalTitle');
                const submitBtn = document.getElementById('submitBtn');
                
                if (modalTitle) modalTitle.textContent = 'Edit Produk';
                if (submitBtn) submitBtn.textContent = '‚úèÔ∏è Update Produk';
                
                const productName = document.getElementById('productName');
                const productPrice = document.getElementById('productPrice');
                const productCategory = document.getElementById('productCategory');
                const productImage = document.getElementById('productImage');
                const productDesc = document.getElementById('productDesc');
                
                if (productName) productName.value = product.name;
                if (productPrice) productPrice.value = product.price;
                if (productCategory) productCategory.value = product.category;
                if (productImage) productImage.value = product.image;
                if (productDesc) productDesc.value = product.desc;
                
                if (product.image) {
                    const preview = document.getElementById('imagePreview');
                    if (preview) {
                        preview.src = product.image;
                        preview.style.display = 'block';
                    }
                }
                
                editingProductId = productId;
                const productModal = document.getElementById('productModal');
                if (productModal) productModal.style.display = 'block';
            } catch (e) {}
        }

        window.handleDeleteProduct = async function(productId, productName) {
            try {
                const confirmDelete = confirm(`üóëÔ∏è Hapus produk "${productName}"?\n\nTindakan ini tidak dapat dibatalkan!`);
                
                if (!confirmDelete) return;
                
                if (isFirebaseConnected && db) {
                    await deleteProduct(productId);
                    showSuccess(`‚úÖ Produk "${productName}" berhasil dihapus!`);
                } else {
                    const index = products.findIndex(p => p.id === productId);
                    if (index > -1) {
                        products.splice(index, 1);
                        displayProducts();
                        showSuccess(`‚úÖ Produk "${productName}" berhasil dihapus! (Mode offline)`);
                    }
                }
            } catch (e) {
                showError('‚ùå Gagal menghapus produk. Silakan coba lagi.');
            }
        }

        // Image Functions
        function compressImage(file, maxWidth = 800, quality = 0.8) {
            return new Promise((resolve) => {
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    
                    img.onload = function() {
                        try {
                            let { width, height } = img;
                            
                            if (width > maxWidth) {
                                height = (height * maxWidth) / width;
                                width = maxWidth;
                            }
                            
                            canvas.width = width;
                            canvas.height = height;
                            
                            ctx.drawImage(img, 0, 0, width, height);
                            
                            const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                            
                            const originalSize = file.size;
                            const compressedSize = Math.round((compressedDataUrl.length * 3) / 4);
                            const compressionRatio = ((originalSize - compressedSize) / originalSize * 100).toFixed(1);
                            
                            resolve({
                                dataUrl: compressedDataUrl,
                                originalSize,
                                compressedSize,
                                compressionRatio
                            });
                        } catch (e) {
                            resolve({
                                dataUrl: URL.createObjectURL(file),
                                originalSize: file.size,
                                compressedSize: file.size,
                                compressionRatio: 0
                            });
                        }
                    };
                    
                    img.onerror = function() {
                        resolve({
                            dataUrl: URL.createObjectURL(file),
                            originalSize: file.size,
                            compressedSize: file.size,
                            compressionRatio: 0
                        });
                    };
                    
                    img.src = URL.createObjectURL(file);
                } catch (e) {
                    resolve({
                        dataUrl: URL.createObjectURL(file),
                        originalSize: file.size,
                        compressedSize: file.size,
                        compressionRatio: 0
                    });
                }
            });
        }

        window.openImageModal = function(imageSrc, title, price, desc, event) {
            try {
                if (event) event.preventDefault();
                
                const modalImage = document.getElementById('modalImage');
                const modalImageTitle = document.getElementById('modalImageTitle');
                const modalImagePrice = document.getElementById('modalImagePrice');
                const modalImageDesc = document.getElementById('modalImageDesc');
                const imageModal = document.getElementById('imageModal');
                
                if (modalImage) modalImage.src = imageSrc;
                if (modalImageTitle) modalImageTitle.textContent = title;
                if (modalImagePrice) modalImagePrice.textContent = price;
                if (modalImageDesc) modalImageDesc.textContent = desc;
                if (imageModal) imageModal.style.display = 'block';
            } catch (e) {}
        }

        window.closeImageModal = function() {
            try {
                const imageModal = document.getElementById('imageModal');
                if (imageModal) imageModal.style.display = 'none';
            } catch (e) {}
        }

        // Search Functions
        window.filterProducts = function(category) {
            try {
                const searchInput = document.getElementById('searchInput');
                if (searchInput) searchInput.value = '';
                searchQuery = '';
                
                document.querySelectorAll('.category-btn').forEach(btn => {
                    try {
                        btn.classList.remove('active');
                    } catch (e) {}
                });
                
                if (event && event.target) {
                    event.target.classList.add('active');
                }
                
                currentFilter = category;
                displayProducts();
            } catch (e) {}
        }

        // Profile Functions
        window.openProfileModal = function() {
            try {
                if (!checkPassword('profile')) {
                    return;
                }
                
                const profileWhatsapp = document.getElementById('profileWhatsapp');
                const profileEmail = document.getElementById('profileEmail');
                const profileInstagram = document.getElementById('profileInstagram');
                const profileBusinessName = document.getElementById('profileBusinessName');
                const profileDescription = document.getElementById('profileDescription');
                const profileModal = document.getElementById('profileModal');
                
                if (profileWhatsapp) profileWhatsapp.value = profileData.whatsapp;
                if (profileEmail) profileEmail.value = profileData.email;
                if (profileInstagram) profileInstagram.value = profileData.instagram.replace('@', '');
                if (profileBusinessName) profileBusinessName.value = profileData.businessName;
                if (profileDescription) profileDescription.value = profileData.description;
                
                if (profileModal) profileModal.style.display = 'block';
            } catch (e) {}
        }

        window.closeProfileModal = function() {
            try {
                const profileModal = document.getElementById('profileModal');
                const profileForm = document.getElementById('profileForm');
                
                if (profileModal) profileModal.style.display = 'none';
                if (profileForm) profileForm.reset();
            } catch (e) {}
        }

        // Announcement Functions
        async function saveAnnouncement(text) {
            if (!isFirebaseConnected || !db) {
                localStorage.setItem('jastip_announcement', text);
                return;
            }
            
            try {
                const docData = { text: text, updatedAt: new Date() };
                
                const q = query(collection(db, "settings"));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    await addDoc(collection(db, "settings"), { type: 'announcement', ...docData });
                } else {
                    const doc = querySnapshot.docs[0];
                    await updateDoc(doc.ref, docData);
                }
            } catch (error) {
                throw error;
            }
        }
        
        async function loadAnnouncement() {
            if (!isFirebaseConnected || !db) {
                const saved = localStorage.getItem('jastip_announcement');
                if (saved) {
                    document.getElementById('announcementContent').textContent = saved;
                }
                return;
            }
            
            try {
                const q = query(collection(db, "settings"));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    const doc = querySnapshot.docs[0];
                    const data = doc.data();
                    if (data.text) {
                        document.getElementById('announcementContent').textContent = data.text;
                    }
                }
            } catch (error) {
                // Silent error
            }
        }

        window.editAnnouncement = function() {
            try {
                const announcementContent = document.getElementById('announcementContent');
                const announcementText = document.getElementById('announcementText');
                const announcementModal = document.getElementById('announcementModal');
                
                if (announcementContent && announcementText) {
                    announcementText.value = announcementContent.textContent;
                }
                if (announcementModal) announcementModal.style.display = 'block';
            } catch (e) {}
        }
        
        window.closeAnnouncementModal = function() {
            try {
                const announcementModal = document.getElementById('announcementModal');
                const announcementForm = document.getElementById('announcementForm');
                
                if (announcementModal) announcementModal.style.display = 'none';
                if (announcementForm) announcementForm.reset();
            } catch (e) {}
        }

        // Event Listeners
        function setupEventListeners() {
            try {
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.addEventListener('input', function(e) {
                        try {
                            searchQuery = e.target.value;
                            displayProducts();
                        } catch (e) {}
                    });
                }

                // Auto-generate category value when typing name
                const newCategoryName = document.getElementById('newCategoryName');
                const newCategoryValue = document.getElementById('newCategoryValue');
                if (newCategoryName && newCategoryValue) {
                    newCategoryName.addEventListener('input', function(e) {
                        if (!newCategoryValue.dataset.userModified) {
                            newCategoryValue.value = generateCategoryValue(e.target.value);
                        }
                    });
                    
                    newCategoryValue.addEventListener('input', function() {
                        newCategoryValue.dataset.userModified = 'true';
                    });
                }

                const productImageFile = document.getElementById('productImageFile');
                if (productImageFile) {
                    productImageFile.addEventListener('change', async function(e) {
                        try {
                            const file = e.target.files[0];
                            if (!file) return;
                            
                            if (!file.type.startsWith('image/')) {
                                alert('‚ùå Please select an image file!');
                                return;
                            }
                            
                            const preview = document.getElementById('imagePreview');
                            const compressionInfo = document.getElementById('compressionInfo');
                            const imageUrlInput = document.getElementById('productImage');
                            
                            if (preview) preview.style.display = 'none';
                            if (compressionInfo) {
                                compressionInfo.style.display = 'block';
                                compressionInfo.innerHTML = '‚è≥ Compressing image...';
                            }
                            
                            try {
                                const result = await compressImage(file);
                                
                                if (preview) {
                                    preview.src = result.dataUrl;
                                    preview.style.display = 'block';
                                }
                                if (imageUrlInput) imageUrlInput.value = result.dataUrl;
                                
                                if (compressionInfo) {
                                    compressionInfo.innerHTML = `
                                        ‚úÖ Image compressed successfully!<br>
                                        üìè Original: ${(result.originalSize / 1024).toFixed(1)} KB ‚Üí 
                                        Compressed: ${(result.compressedSize / 1024).toFixed(1)} KB 
                                        (${result.compressionRatio}% reduction)
                                    `;
                                }
                            } catch (error) {
                                if (compressionInfo) {
                                    compressionInfo.innerHTML = '‚ùå Error compressing image. Please try again.';
                                }
                            }
                        } catch (e) {}
                    });
                }

                const productImage = document.getElementById('productImage');
                if (productImage) {
                    productImage.addEventListener('input', function(e) {
                        try {
                            const url = e.target.value;
                            const preview = document.getElementById('imagePreview');
                            
                            if (url && preview) {
                                preview.src = url;
                                preview.style.display = 'block';
                                const productImageFile = document.getElementById('productImageFile');
                                const compressionInfo = document.getElementById('compressionInfo');
                                if (productImageFile) productImageFile.value = '';
                                if (compressionInfo) compressionInfo.style.display = 'none';
                            } else if (preview) {
                                preview.style.display = 'none';
                            }
                        } catch (e) {}
                    });
                }

                // Form submit handlers
                const addCategoryForm = document.getElementById('addCategoryForm');
                if (addCategoryForm) {
                    addCategoryForm.addEventListener('submit', async function(e) {
                        try {
                            e.preventDefault();
                            
                            const name = document.getElementById('newCategoryName').value;
                            const value = document.getElementById('newCategoryValue').value;
                            
                            // Check for duplicate values
                            if (categories.some(cat => cat.value === value)) {
                                alert('‚ùå Kategori dengan value ini sudah ada! Gunakan value yang berbeda.');
                                return;
                            }
                            
                            const categoryData = { name: name, value: value };
                            
                            if (isFirebaseConnected && db) {
                                await saveCategory(categoryData);
                            } else {
                                categories.push({ id: Date.now().toString(), ...categoryData });
                                displayCategories();
                                updateCategoryDropdown();
                                displayCategoryList();
                            }
                            
                            showSuccess(`‚úÖ Kategori "${name}" berhasil ditambahkan!`);
                            addCategoryForm.reset();
                            // Reset the auto-generation flag
                            document.getElementById('newCategoryValue').dataset.userModified = '';
                        } catch (e) {
                            showError('‚ùå Gagal menambah kategori. Silakan coba lagi.');
                        }
                    });
                }

                const editCategoryForm = document.getElementById('editCategoryForm');
                if (editCategoryForm) {
                    editCategoryForm.addEventListener('submit', async function(e) {
                        try {
                            e.preventDefault();
                            
                            const categoryId = document.getElementById('editCategoryId').value;
                            const name = document.getElementById('editCategoryName').value;
                            const value = document.getElementById('editCategoryValue').value;
                            
                            // Check for duplicate values (excluding current category)
                            if (categories.some(cat => cat.value === value && cat.id !== categoryId)) {
                                alert('‚ùå Kategori dengan value ini sudah ada! Gunakan value yang berbeda.');
                                return;
                            }
                            
                            const categoryData = { name: name, value: value };
                            
                            if (isFirebaseConnected && db) {
                                await updateCategory(categoryId, categoryData);
                            } else {
                                const index = categories.findIndex(c => c.id === categoryId);
                                if (index > -1) {
                                    categories[index] = { ...categories[index], ...categoryData };
                                    displayCategories();
                                    updateCategoryDropdown();
                                    displayCategoryList();
                                }
                            }
                            
                            showSuccess(`‚úÖ Kategori "${name}" berhasil diupdate!`);
                            window.closeEditCategoryModal();
                        } catch (e) {
                            showError('‚ùå Gagal mengupdate kategori. Silakan coba lagi.');
                        }
                    });
                }

                const profileForm = document.getElementById('profileForm');
                if (profileForm) {
                    profileForm.addEventListener('submit', async function(e) {
                        try {
                            e.preventDefault();
                            
                            const newProfileData = {
                                whatsapp: document.getElementById('profileWhatsapp').value,
                                email: document.getElementById('profileEmail').value,
                                instagram: '@' + document.getElementById('profileInstagram').value.replace('@', ''),
                                businessName: document.getElementById('profileBusinessName').value,
                                description: document.getElementById('profileDescription').value
                            };
                            
                            await saveProfile(newProfileData);
                            profileData = { ...profileData, ...newProfileData };
                            updateProfileDisplay();
                            
                            showSuccess('‚úÖ Profil berhasil disimpan!');
                            window.closeProfileModal();
                        } catch (e) {
                            showError('‚ùå Gagal menyimpan profil. Silakan coba lagi.');
                        }
                    });
                }
                
                const productForm = document.getElementById('productForm');
                if (productForm) {
                    productForm.addEventListener('submit', async function(e) {
                        try {
                            e.preventDefault();
                            
                            const imageInput = document.getElementById('productImage');
                            let imageUrl = imageInput ? imageInput.value : '';
                            
                            if (!imageUrl) {
                                showError('‚ùå Gambar produk wajib diisi');
                                return;
                            }
                            
                            const productData = {
                                name: document.getElementById('productName').value,
                                price: document.getElementById('productPrice').value,
                                category: document.getElementById('productCategory').value,
                                image: imageUrl,
                                desc: document.getElementById('productDesc').value
                            };
                            
                            if (isFirebaseConnected && db) {
                                if (editingProductId) {
                                    await updateProduct(editingProductId, productData);
                                    showSuccess('‚úÖ Produk berhasil diupdate!');
                                } else {
                                    await saveProduct(productData);
                                    showSuccess('‚úÖ Produk berhasil ditambahkan!');
                                }
                            } else {
                                if (editingProductId) {
                                    const index = products.findIndex(p => p.id === editingProductId);
                                    if (index > -1) {
                                        products[index] = { ...products[index], ...productData };
                                    }
                                    showSuccess('‚úÖ Produk berhasil diupdate! (Mode offline)');
                                } else {
                                    products.unshift({ id: Date.now().toString(), ...productData });
                                    showSuccess('‚úÖ Produk berhasil ditambahkan! (Mode offline)');
                                }
                                displayProducts();
                            }
                            
                            window.closeModal();
                        } catch (e) {
                            showError('‚ùå Gagal menyimpan produk. Silakan coba lagi.');
                        }
                    });
                }
                
                const announcementForm = document.getElementById('announcementForm');
                if (announcementForm) {
                    announcementForm.addEventListener('submit', async function(e) {
                        try {
                            e.preventDefault();
                            
                            const announcementText = document.getElementById('announcementText');
                            const announcementContent = document.getElementById('announcementContent');
                            
                            if (announcementText && announcementContent) {
                                await saveAnnouncement(announcementText.value);
                                announcementContent.textContent = announcementText.value;
                            }
                            
                            showSuccess('‚úÖ Pengumuman berhasil diupdate!');
                            window.closeAnnouncementModal();
                        } catch (e) {
                            showError('‚ùå Gagal menyimpan pengumuman. Silakan coba lagi.');
                        }
                    });
                }

                // ESC key to close modals
                document.addEventListener('keydown', function(event) {
                    try {
                        if (event.key === 'Escape') {
                            window.closeImageModal();
                            window.closeModal();
                            window.closeProfileModal();
                            window.closeAnnouncementModal();
                            window.closeCategoryModal();
                            window.closeEditCategoryModal();
                        }
                    } catch (e) {}
                });

                // Close modal when clicking outside
                window.onclick = function(event) {
                    try {
                        const productModal = document.getElementById('productModal');
                        const announcementModal = document.getElementById('announcementModal');
                        const profileModal = document.getElementById('profileModal');
                        const categoryModal = document.getElementById('categoryModal');
                        const editCategoryModal = document.getElementById('editCategoryModal');
                        
                        if (event.target === productModal) {
                            window.closeModal();
                        } else if (event.target === announcementModal) {
                            window.closeAnnouncementModal();
                        } else if (event.target === profileModal) {
                            window.closeProfileModal();
                        } else if (event.target === categoryModal) {
                            window.closeCategoryModal();
                        } else if (event.target === editCategoryModal) {
                            window.closeEditCategoryModal();
                        }
                    } catch (e) {}
                }
            } catch (e) {}
        }

        // Initialize
        function init() {
            try {
                initFirebase();
                setTimeout(() => {
                    loadCategories();
                    loadProducts();
                    loadAnnouncement();
                    setupEventListeners();
                }, 1000);
            } catch (e) {}
        }

        // Start when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
